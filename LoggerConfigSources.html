<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SELKIELogger: Source Definitions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SELKIELogger
   &#160;<span id="projectnumber">0.9.18</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('LoggerConfigSources.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Source Definitions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md28">Generic configuration options</a></li>
<li class="level1"><a href="#SupportedSources">Supported Sources and Devices</a><ul><li class="level2"><a href="#LoggerSource-GPS">GPS Source Options</a></li>
<li class="level2"><a href="#LoggerSource-MP">MP Source Options</a></li>
<li class="level2"><a href="#LoggerSource-I2C">I2C Source Options</a><ul><li class="level3"><a href="#LoggerSource-INA219">INA219 Voltage and current monitor (ina219)</a></li>
<li class="level3"><a href="#LoggerSource-ADS1015">ADS1015 ADC (ads1015)</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md29">NMEA Source Options</a><ul><li class="level3"><a href="#autotoc_md30">NMEA 0183</a></li>
<li class="level3"><a href="#autotoc_md31">NMEA 2000</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md32">Datawell Source Options</a></li>
<li class="level2"><a href="#autotoc_md33">MQTT Source Options</a><ul><li class="level3"><a href="#autotoc_md34">Victron Energy devices</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md35">Timer source options</a></li>
<li class="level2"><a href="#autotoc_md36">Record only sources</a><ul><li class="level3"><a href="#autotoc_md37">Network / TCP sources</a></li>
<li class="level3"><a href="#autotoc_md38">Serial sources</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md39">Example Configuration</a></li>
<li class="level1"><a href="#devicenames">Device Names</a></li>
<li class="level1"><a href="#autotoc_md40">Further reading</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_guide_Logger_Config_Sources"></a></p>
<p>Each source is configured in its own section, starting with a section tag in square brackets (e.g. <code>[Bus01]</code>, <code>[DW]</code>) and followed by the source specific configuration values. The name given in the tag is used when printing log messages to identify the source responsible for them and will be used as the source name unless overridden by a <code>name</code> option.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Generic configuration options</h1>
<p>Common to almost all supported sources are the options <code>name</code>, <code>type</code>, and <code>sourcenum</code>. Of these, <code>type</code> is mandatory.</p>
<div class="fragment"><div class="line">[Bus01]           <span class="comment"># Section tag</span></div>
<div class="line">name = Marine     <span class="comment"># Source name</span></div>
<div class="line">type = n2k        <span class="comment"># Source type (mandatory)</span></div>
<div class="line">sourcenum = 0x61  <span class="comment"># Source number</span></div>
</div><!-- fragment --><p>The <code>type</code> options identifies which of the supported source types are being configured by this block. Blocks without a valid <code>type</code> specified will generate an error. See <a class="el" href="LoggerConfigSources.html#SupportedSources">supported sources</a> for details of valid type options.</p>
<p>The <code>name</code> option controls the reported source name used in the channel information file, which is then available for subsequent processing and data conversion software. If not provided, it defaults to the section tag. The name is arbitrary information and is not used by the logging software itself.</p>
<p>The <code>sourcenum</code> option controls the ID number used to identify messages from this source. There can be only one source active with a given number for a particular configuration.</p>
<p>If no <code>sourcenum</code> option is present, a suitable value will be configured automatically. Numbers can be specified in decimal or, as shown in the example above, as hexadecimal digits prefixed with <code>0x</code>.</p>
<h1><a class="anchor" id="SupportedSources"></a>
Supported Sources and Devices</h1>
<p>Each source is defined in its own section, with the tag, name, and source number specified as described above. The <code>type</code> option is required before the source specific options will be processed, and unknown options are generally ignored.</p>
<p>Each of the sections below will show a small example configuration section, then provide more detailed explanation of all valid configuration options for that source type. In the configuration examples, "#" marks an explanatory comment that should be omitted when creating your own configuration files.</p>
<h2><a class="anchor" id="LoggerSource-GPS"></a>
GPS Source Options</h2>
<p><b>type = GPS</b></p>
<p>The current GPS code is limited to supporting uBlox based GPS devices attached via a serial or USB connection.</p>
<div class="fragment"><div class="line">[GPS01]</div>
<div class="line">type = GPS          <span class="comment"># Mandatory</span></div>
<div class="line">port = /dev/ttyUSB1 <span class="comment"># Path to serial device</span></div>
<div class="line">initialbaud = 9600  <span class="comment"># Initial baud rate after reset</span></div>
<div class="line">baud = 115200       <span class="comment"># Baud rate for general usage</span></div>
<div class="line">dumpall = false     <span class="comment"># Include all output messages</span></div>
</div><!-- fragment --><ul>
<li><code>port</code>: Serial port name or path. See also <a class="el" href="LoggerConfigSources.html#devicenames">device names</a>.</li>
<li><code>initialbaud</code>: Initial baud rate to use. Some uBlox devices start at a slower rate and need to be reconfigured to a more suitable rate for general data transfer, so set the initial power-up/reset baud rate here.</li>
<li><code>baud</code>: General baud rate to use after initial configuration.</li>
<li><code>dumpall</code>: Enable unfiltered output, passing (and recording) additional messages in the output file. Otherwise, only parsed messages are saved, reducing the size of the recorded data files.</li>
</ul>
<h2><a class="anchor" id="LoggerSource-MP"></a>
MP Source Options</h2>
<p><b>type = MP</b> or <b>type = SL</b></p>
<p>This source type is for use with devices that directly output msgpack formatted data as described in the <a class="el" href="LoggerTechDetails.html">Logger technical details</a> page.</p>
<div class="fragment"><div class="line">[MP02]</div>
<div class="line">type = MP           <span class="comment"># Mandatory</span></div>
<div class="line">port = /dev/ttyACM0 <span class="comment"># Path to serial device</span></div>
<div class="line">baud = 115200       <span class="comment"># Baud rate</span></div>
</div><!-- fragment --><ul>
<li><code>port</code>: Serial port name or path. See also <a class="el" href="LoggerConfigSources.html#devicenames">device names</a>.</li>
<li><code>baud</code>: General baud rate to use after initial configuration.</li>
</ul>
<p>Note that the general <code>sourcenum</code> and <code>name</code> parameters are ignored here, as they will be provided directly by the connected device.</p>
<p>The source tag (<code>MP02</code> in this example) will be used in any log messages generated by the logging software.</p>
<h2><a class="anchor" id="LoggerSource-I2C"></a>
I2C Source Options</h2>
<p><b>type = I2C</b> </p><div class="fragment"><div class="line">[AutomationHat]</div>
<div class="line">type = I2C                  <span class="comment"># Mandatory</span></div>
<div class="line">bus = /dev/i2c-1            <span class="comment"># Path to I2C bus</span></div>
<div class="line">ads1015=0x48:4:0.007:0.002  <span class="comment"># Device specific configuration</span></div>
<div class="line">frequency = 2               <span class="comment"># Bus polling frequency</span></div>
</div><!-- fragment --><p>There are two general parameters that need to be provided in order to record data from I2C connected sensors.</p>
<ul>
<li><code>bus</code>: Path to the I2C bus / device. See <a class="el" href="LoggerConfigSources.html#devicenames">device names</a> for some generic considerations here</li>
<li><code>frequency</code>: Number of sensor readings to request per second.</li>
</ul>
<p>Unlike most other data sources, I2C readings must be requested by the logging software rather than being recorded on arrival. The frequency set here is a single value per bus, so must be supported by all sensors in use.</p>
<p>After defining the bus name and polling frequency, each individual sensor must be configured. In general, each sensor definition will need to provide a sensor type, I2C address and the (base) channel ID.</p>
<p>The sensor type is provided by the configuration option name (which may be present more than once), with the I2C address and base message ID provided in hex, separated by a colon. In the example configuration, an ADS1015 sensor is being configured at address 72 (0x48) and the first value provided by that sensor will be at channel 4. If the base message ID is missing, a default will be substituted. Mixing automatic and manual allocation of base message ID may lead to conflicts and is not recommended.</p>
<h3><a class="anchor" id="LoggerSource-INA219"></a>
INA219 Voltage and current monitor (ina219)</h3>
<p>The INA219 chip measures the current being supplied to a circuit through a shunt resistor. Each chip provides three measurements, using three sequential channel numbers:</p><ul>
<li>Channel <code>n</code>: Bus voltage (supply voltage to the positive side of the shunt resistor) [Volts]</li>
<li>Channel <code>n+1</code>: Shunt voltage (voltage drop across the shunt resistor) [millivolts]</li>
<li>Channel <code>n+2</code>: Current flowing to the load (calculated from the voltage drop across the shunt resistor) [Amps]</li>
</ul>
<p>Multiple chips can be connected to a single I2C bus using different addresses, and the channel numbers can optionally be set in the configuration file.</p>
<p>To read from an INA219 chip, add the following line to the source definition: </p><div class="fragment"><div class="line"><span class="comment"># ina219 = address[:channel]</span></div>
<div class="line">ina219 = 0x32    <span class="comment"># Device at address 0x32, automatically numbering channels</span></div>
<div class="line">ina219 = 0x33:7  <span class="comment"># Device at address 0x33, using channels 7, 8, and 9</span></div>
</div><!-- fragment --><p>Add additional lines for each chip connected to that I2C bus.</p>
<p>As an example, the <a href="https://www.waveshare.com/wiki/Current/Power_Monitor_HAT">Waveshare Current/Power monitor hat</a> could be configured as shown:</p>
<div class="fragment"><div class="line">[PM]</div>
<div class="line">type = I2C</div>
<div class="line">bus = /dev/i2c-1</div>
<div class="line">frequency = 2</div>
<div class="line">ina219 = 0x40:4</div>
<div class="line">ina219 = 0x41:7</div>
<div class="line">ina219 = 0x42:10</div>
<div class="line">ina219 = 0x43:13</div>
</div><!-- fragment --><h3><a class="anchor" id="LoggerSource-ADS1015"></a>
ADS1015 ADC (ads1015)</h3>
<p>The ADS101x series of analog-digital conversion chips measure analog voltage levels and output that information digitally over I2C. These chips are used in several ADC implementations that can be connected to single board computers (such as a Raspberry Pi) or to microcontrollers (including the Arduino family of devices).</p>
<p>The current implementation assumes that the chip used is an ADS1015 device, which provides 4 inputs. These are assigned channel numbers <code>n</code> to <code>n+3</code>, where <code>n</code> is the base channel ID. Adding an ADS1015 chip as a source requires its I2C address, and optionally the base channel number can be provided as described above for INA219 chips. </p><div class="fragment"><div class="line">ads1015 = 0x48</div>
<div class="line">ads1015 = 0x47:5</div>
</div><!-- fragment --><p>Additionally, scaling, offset, and limit values can be provided as colon separated values in order. In this case, the base channel ID must also be supplied. Scaling is applied linearly to each channel, multiplying the original value by the scaling factor and then adding the offset. Values that then lie outside any configured limits will be replaced with NaN values.</p>
<p>The default values are a scale of 1.0, offset of 0 and limits of <img class="formulaInl" alt="$-\infty,+\infty$" src="form_0.png"/>.</p>
<div class="fragment"><div class="line"><span class="comment"># ads1015 = addr:base:scale:offset:min:max</span></div>
<div class="line">ads1015 = 0x47:5:3.22:-17.75:-15:+30</div>
<div class="line">ads1015 = 0x48:9:1.0:-5</div>
</div><!-- fragment --><p>In the first of these examples, data from the chip at address 0x47 would be multiplied by 3.22 and offset by -17.75. Note that this would be applied to all four channels. The resulting values would be replaced with NaN if the results are below -15 or above +30.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
NMEA Source Options</h2>
<h3><a class="anchor" id="autotoc_md30"></a>
NMEA 0183</h3>
<p><b>type = NMEA</b></p>
<p>This source type allows messages broadcast in NMEA0183 format to be captured, with some messages interpreted for more convenient use and analysis. The connected device can either be a single serial device that outputs messages in this format, or a serial interface to an NMEA0183 bus.</p>
<div class="fragment"><div class="line">[NM03]</div>
<div class="line">type = NMEA         <span class="comment"># Mandatory</span></div>
<div class="line">port = /dev/ttyUSB3 <span class="comment"># Path to serial device</span></div>
<div class="line">baud = 115200       <span class="comment"># Baud rate</span></div>
</div><!-- fragment --><p>Currently, the following messages are parsed into their own channels:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Talker   </th><th class="markdownTableHeadCenter">Message   </th><th class="markdownTableHeadLeft">Description   </th><th class="markdownTableHeadCenter">Channel Number    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">II   </td><td class="markdownTableBodyCenter">ZDA   </td><td class="markdownTableBodyLeft">Date / Time   </td><td class="markdownTableBodyCenter">4   </td></tr>
</table>
<p>All other messages are stored in channel 3 for later extraction and analysis.</p>
<h3><a class="anchor" id="autotoc_md31"></a>
NMEA 2000</h3>
<p><b>type = N2K</b></p>
<p>The newer NMEA 2000 format is a binary encoded message format, similar to CAN messages in the automotive sector. Support for this communications format is currently limited to the Actisense NGT-1 interface, which receives encoded messages from an NMEA 2000 bus and rebroadcasts them via serial or USB to a connected computer.</p>
<div class="fragment"><div class="line">[N2K]</div>
<div class="line">type = n2k          <span class="comment"># Mandatory</span></div>
<div class="line">port = /dev/ttyUSB6 <span class="comment"># Path to serial device</span></div>
<div class="line">baud = 115200       <span class="comment"># Baud rate</span></div>
</div><!-- fragment --><ul>
<li><code>port</code>: Serial port name or path. See also <a class="el" href="LoggerConfigSources.html#devicenames">device names</a>.</li>
<li><code>baud</code>: Serial data baud rate - must match configuration on the Actisense device</li>
</ul>
<p>The <code>sourcenum</code> and <code>name</code> parameters should also be provided to make later analysis more consistent.</p>
<p>Currently, the following messages are parsed into their own channels:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">PGN   </th><th class="markdownTableHeadLeft">Description   </th><th class="markdownTableHeadCenter">Channel Number    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">129025   </td><td class="markdownTableBodyLeft">Position (Lat/Lon)   </td><td class="markdownTableBodyCenter">4 (Lat) / 5 (Lon)   </td></tr>
</table>
<p>All other messages are stored in channel 3 for later extraction and analysis.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Datawell Source Options</h2>
<p><b>type = DW</b></p>
<p>This source type allows data to be recorded from a Datawell Waverider via a <a href="https://datawell.nl/products/receiver-rx-c/">RX-C reciever</a> connected to the local network.</p>
<div class="fragment"><div class="line">[BoB]</div>
<div class="line">type = DW             <span class="comment"># Mandatory</span></div>
<div class="line">host = <span class="stringliteral">&quot;172.16.104.1&quot;</span> <span class="comment"># Receiver IP address</span></div>
<div class="line">timeout = 3600        <span class="comment"># Max. seconds to wait for data</span></div>
<div class="line">raw = true            <span class="comment"># Record raw messages received</span></div>
<div class="line">spectrum = false      <span class="comment"># Parse spectral data</span></div>
</div><!-- fragment --><ul>
<li><code>host</code> - IP address or DNS name for the RF receiver. The port number is fixed at 1180</li>
<li><code>timeout</code> - Consider the connection lost if no data is received after this period (in seconds).</li>
<li><code>raw</code> - Record raw message data from the receiver in addition to parsed data. Recommended.</li>
<li><code>spectrum</code> - Parse spectral information into data file.<ul>
<li>This is not recommended, as much of the structure of the spectral data is not preserved in the output file in this format.</li>
<li>It is recommended to record raw messages and then extract the data for analysis later.</li>
</ul>
</li>
</ul>
<p>This source generates several channels of data, the full details of which are documented in the source code for <a class="el" href="group__loggerDW.html#ga0f119d1ddaa6e9f0f7057a30c5463b21" title="Channel map.">dw_channels()</a>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Description   </th><th class="markdownTableHeadCenter">Channel Number    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Raw Data   </td><td class="markdownTableBodyCenter">3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Signal   </td><td class="markdownTableBodyCenter">4    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Displacement N   </td><td class="markdownTableBodyCenter">5    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Displacement W   </td><td class="markdownTableBodyCenter">6    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Displacement V   </td><td class="markdownTableBodyCenter">7    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Latitude   </td><td class="markdownTableBodyCenter">8    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Longitude   </td><td class="markdownTableBodyCenter">9    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Orientation   </td><td class="markdownTableBodyCenter">10    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Inclination   </td><td class="markdownTableBodyCenter">11    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">GPS Status   </td><td class="markdownTableBodyCenter">12    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RMS Height   </td><td class="markdownTableBodyCenter">13    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Reference Temperature   </td><td class="markdownTableBodyCenter">14    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Water Temperature   </td><td class="markdownTableBodyCenter">15    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Weeks of battery remaining   </td><td class="markdownTableBodyCenter">16    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Spectrum: FrequencyBin   </td><td class="markdownTableBodyCenter">17    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Spectrum: Direction   </td><td class="markdownTableBodyCenter">18    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Spectrum: Spread   </td><td class="markdownTableBodyCenter">19    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Spectrum: m2   </td><td class="markdownTableBodyCenter">20    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Spectrum: n2   </td><td class="markdownTableBodyCenter">21    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Spectrum: RPSD   </td><td class="markdownTableBodyCenter">22    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Spectrum: K   </td><td class="markdownTableBodyCenter">23   </td></tr>
</table>
<p>Channels 17-23 are only output if the <code>spectrum</code> option is enabled.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
MQTT Source Options</h2>
<p><b>type=MQTT</b></p>
<p>It is possible to read topics from a MQTT server and convert the values found into channels to be recorded by the logging software. This can be useful to interface with existing data collection software where duplicate instrumentation may not be viable. It should be noted that additional latency will be introduced by both the network connection, MQTT server, and the software used to feed data to it. This may need to be adjusted for when analysing the data after recording.</p>
<p>The MQTT system allows a server to mediate between multiple clients. Messages are exchanged between clients publishing messages to a named topic and other clients subscribing to that same topic. Topics are arranged in a hierarchy, and it is possible to subscribe to a given topic and all others that fall underneath it in that hierarchy. The format of the individual messages is arbitrary, and this logging software supports only a limited number of formats.</p>
<div class="fragment"><div class="line">[Buzz]</div>
<div class="line">type = MQTT         <span class="comment"># Mandatory</span></div>
<div class="line">host = 172.16.105.1 <span class="comment"># Server IP or host name</span></div>
<div class="line">port = 1883         <span class="comment"># TCP port number</span></div>
<div class="line">dumpall = false     <span class="comment"># Record unrequested / unexpected messages</span></div>
</div><!-- fragment --><p>The general configuration for a MQTT source is shown above, and uses the following parameters:</p><ul>
<li><code>host</code> - IP address or DNS name of the server</li>
<li><code>port</code> - TCP port number. A default (1883) will be used if not provided.</li>
<li><code>dumpall</code> - Record unknown messages to file (see below)</li>
</ul>
<p>In the default configuration, the logging software will subscribe to specific topics and map messages sent to those topics to individual channels. Any messages received for other topics will be discarded. If the <code>dumpall</code> option is enabled then any messages not listed in the configuration will be recorded to channel 3 (the raw data channel) as strings with the format "topic: value". This would be required if using wildcards to receive messages for a group of topics, as no channel number would be allocated to them.</p>
<div class="fragment"><div class="line"><span class="comment"># topic = &lt;topic&gt;[:&lt;channel name&gt;[:&lt;text mode&gt;]]</span></div>
<div class="line">topic = /top/DC/Source:Source Name:true</div>
<div class="line">topic = /top/AC/Voltage:Mains Voltage</div>
</div><!-- fragment --><p>Each topic to be recorded needs to be added to the source definition using the <code>topic</code> option. Optionally, a channel name and text mode flag can be set, each separated by a colon as shown in the examples above. Channel numbers are allocated dynamically, but would normally be allocated in the order listed in the configuration.</p>
<p>If specified, the channel name given will be added to the channel mapping file to allow data from each topic to be identified. If no channel name is specified then the topic will be used instead.</p>
<p>The <code>text mode</code> flag will cause that topic to be stored in the recorded data as text. If not set, non-numeric data will be discarded or may generate errors.</p>
<h3><a class="anchor" id="autotoc_md34"></a>
Victron Energy devices</h3>
<div class="fragment"><div class="line">victron_keepalives = false <span class="comment"># Enable Victron specific keepalives (see below)</span></div>
<div class="line">sysid = <span class="stringliteral">&quot;AXBYCZ&quot;</span>           <span class="comment"># Victron System ID (required for keepalives)</span></div>
<div class="line">keepalive_interval = 20   <span class="comment"># Keepalive time in seconds</span></div>
</div><!-- fragment --><p>Some Victron Energy systems allow data to be retrieved over MQTT locally, as described <a href="https://github.com/victronenergy/dbus-mqtt/blob/master/README.md">on their GitHub page</a>. This does require a specific message to be published to keep the connection active, which can be enabled using these additional options.</p>
<ul>
<li><code>victron_keepalives</code> - Enable or disable these messages</li>
<li><code>sysid</code> - The Victron device's ID needs to be incorporated into the keepalive request</li>
<li><code>keepalive_interval</code> - Messages will be sent at this interval, which must be less than the timeout on the Victron device.</li>
</ul>
<h2><a class="anchor" id="autotoc_md35"></a>
Timer source options</h2>
<p><b>type=timer</b> or <b>type=tick</b> </p><div class="fragment"><div class="line">[TICK]</div>
<div class="line">type=timer    <span class="comment"># Mandatory</span></div>
<div class="line">frequency=1   <span class="comment"># Marker frequency in Hz</span></div>
</div><!-- fragment --><p>In addition to the default timer, additional time sources can be defined to create timestamps at other intervals. The minimum frequency is 1Hz and values are currently limited to integers.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Record only sources</h2>
<p>The last two data sources are provided to allow capture and storage of arbitrary data without parsing or interpretation.</p>
<h3><a class="anchor" id="autotoc_md37"></a>
Network / TCP sources</h3>
<div class="fragment"><div class="line">type = net                <span class="comment"># Mandatory</span></div>
<div class="line">host = <span class="stringliteral">&quot;172.16.104.12&quot;</span>    <span class="comment"># Source IP address or host name</span></div>
<div class="line">port = 2800               <span class="comment"># TCP port to connect to</span></div>
<div class="line">timeout = 100             <span class="comment"># Max. seconds to wait for data</span></div>
<div class="line">minbytes = 100            <span class="comment"># Minimum byte count per message</span></div>
<div class="line">maxbytes = 1024           <span class="comment"># Maximum byte count per message</span></div>
</div><!-- fragment --><ul>
<li><code>host</code> - IP address or host name to connect to</li>
<li><code>port</code> - TCP port to connect to</li>
<li><code>timeout</code> - Consider the connection lost if no data is received after this period (in seconds).</li>
<li><code>minbytes</code> - Only generate a message to be logged when at least this many bytes are available</li>
<li><code>maxbytes</code> - Maximum number of bytes to be included in a single message</li>
</ul>
<p>In the absence of more details about the data being recorded, the <code>minbytes</code> and <code>maxbytes</code> parameters should be set to generate no more than <a class="el" href="LoggerConfigCore.html">`frequency`</a> messages per second. It is also recommended to keep <code>minbytes</code> above 10 to avoid inflating the file size with excess message headers (~5 bytes per message).</p>
<h3><a class="anchor" id="autotoc_md38"></a>
Serial sources</h3>
<div class="fragment"><div class="line">type = serial             <span class="comment"># Mandatory</span></div>
<div class="line">port = <span class="stringliteral">&quot;/dev/ttyACM2&quot;</span>     <span class="comment"># Serial port to monitor</span></div>
<div class="line">baud = 9600               <span class="comment"># Baud rate</span></div>
<div class="line">minbytes = 100            <span class="comment"># Minimum byte count per message</span></div>
<div class="line">maxbytes = 1024           <span class="comment"># Maximum byte count per message</span></div>
</div><!-- fragment --><ul>
<li><code>port</code>: Serial port name or path. See also <a class="el" href="LoggerConfigSources.html#devicenames">device names</a>.</li>
<li><code>baud</code>: Serial data baud rate</li>
<li><code>minbytes</code> - Only generate a message to be logged when at least this many bytes are available</li>
<li><code>maxbytes</code> - Maximum number of bytes to be included in a single message</li>
</ul>
<p>As with the generic network source, the <code>minbytes</code> and <code>maxbytes</code> parameters should be set to generate no more than <a class="el" href="LoggerConfigCore.html">`frequency`</a> messages per second. It is also recommended to keep <code>minbytes</code> above 10 to avoid inflating the file size with excess message headers (~5 bytes per message).</p>
<h1><a class="anchor" id="autotoc_md39"></a>
Example Configuration</h1>
<div class="fragment"><div class="line">stateFile = <span class="stringliteral">&quot;testData/logger.state&quot;</span></div>
<div class="line">saveState = <span class="keyword">True</span></div>
<div class="line">prefix = <span class="stringliteral">&quot;testData/Log-&quot;</span></div>
<div class="line">verbose = 3</div>
<div class="line">frequency = 10</div>
<div class="line"> </div>
<div class="line">[GPS01]</div>
<div class="line">baud = 19200</div>
<div class="line">sourcenum = 5</div>
<div class="line">type = GPS</div>
<div class="line"><span class="comment"># N.B. Can&#39;t assume this will always be the same device</span></div>
<div class="line"><span class="comment"># Consider using udev rules to give devices permanent names</span></div>
<div class="line">port = <span class="stringliteral">&quot;/dev/ttyUSB0&quot;</span></div>
<div class="line"> </div>
<div class="line">[AutomationHat]</div>
<div class="line">type = I2C</div>
<div class="line">bus = /dev/i2c-1</div>
<div class="line">ads1015=0x48:4:0.00788842:0.002</div>
<div class="line">frequency = 2</div>
</div><!-- fragment --><h1><a class="anchor" id="devicenames"></a>
Device Names</h1>
<p>Most external devices are represented on a Linux machine by named files in the <code>/dev</code> directory (e.g. <code>/dev/ttyUSB0</code> for a USB serial adapter, <code>/dev/i2c-1</code> for an I2C interface). The names of many of these files are dynamic, and are assigned when devices are connected or when they are discovered during start up. This means that the numbered suffix may change if a device is unplugged and reconnected, and may change when the computer is rebooted. This is a particular problem for USB serial devices that may be used as data sources (i.e. anything starting <code>/dev/tty</code>).</p>
<p>Rather than use the short dynamically assigned names in configuration files, a stable name should be used. On Debian (and therefore Raspberry Pi OS) based devices, stable names can be found in <code>/dev/serial/by-id/</code> with file names based on the make, model, and serial number of the serial interface (which may differ from the equipment serial number).</p>
<p>As a modified example from a real system: </p><div class="fragment"><div class="line">tom@local:~ $ ls -l /dev/serial/by-id/</div>
<div class="line">lrwxrwxrwx 1 root root 13 May 25 13:29 usb-Actisense_NGT-1 -&gt; ../../ttyUSB0</div>
<div class="line">lrwxrwxrwx 1 root root 13 May 25 13:29 usb-Silicon_Labs__LPMSCU30006 -&gt; ../../ttyUSB1</div>
<div class="line">lrwxrwxrwx 1 root root 13 May 25 20:44 usb-u-blox_AG_-_GPS_GNSS_Receiver -&gt; ../../ttyACM1</div>
</div><!-- fragment --><p>The short names at the time this list was generated are shown at the end of the line.</p>
<p>Another option is to write udev rules to create custom names for each connected device. How to write these rules is outside the scope of this documentation.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Further reading</h1>
<ul>
<li>Up: <a class="el" href="LoggerConfig.html">Logger configuration</a></li>
<li>Prev: <a class="el" href="LoggerConfigCore.html">Logger core options</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="Logger.html">Logger User Guide</a></li><li class="navelem"><a class="el" href="LoggerConfig.html">Configuration</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
