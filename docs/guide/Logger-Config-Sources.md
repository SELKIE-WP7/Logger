# Source Definitions {#LoggerConfigSources}
[TOC]

Each source is configured in its own section, starting with a section tag in square brackets (e.g. `[Bus01]`, `[DW]`) and followed by the source specific configuration values.
The name given in the tag is used when printing log messages to identify the source responsible for them and will be used as the source name unless overridden by a `name` option.

## Generic configuration options
Common to almost all supported sources are the options `name`, `type`, and `sourcenum`.
Of these, `type` is mandatory.

~~~{.py}
[Bus01]           # Section tag
name = Marine     # Source name
type = n2k        # Source type (mandatory)
sourcenum = 0x61  # Source number
~~~

The `type` options identifies which of the supported source types are being configured by this block.
Blocks without a valid `type` specified will generate an error.
See [supported sources](@ref SupportedSources) for details of valid type options.

The `name` option controls the reported source name used in the channel information file, which is then available for subsequent processing and data conversion software.
If not provided, it defaults to the section tag.
The name is arbitrary information and is not used by the logging software itself.

The `sourcenum` option controls the ID number used to identify messages from this source.
There can be only one source active with a given number for a particular configuration.

If no `sourcenum` option is present, a suitable value will be configured automatically.
Numbers can be specified in decimal or, as shown in the example above, as hexadecimal digits prefixed with `0x`.

## Supported Sources and Devices {#SupportedSources}
Each source is defined in its own section, with the tag, name, and source number specified as described above.
The `type` option is required before the source specific options will be processed, and unknown options are generally ignored.

Each of the sections below will show a small example configuration section, then provide more detailed explanation of all valid configuration options for that source type. In the configuration examples, "#" marks an explanatory comment that should be omitted when creating your own configuration files.

### GPS Source Options {#LoggerSource-GPS}
**type = GPS**

The current GPS code is limited to supporting uBlox based GPS devices attached via a serial or USB connection.

~~~{.py}
[GPS01]
type = GPS          # Mandatory
port = /dev/ttyUSB1 # Path to serial device
initialbaud = 9600  # Initial baud rate after reset
baud = 115200       # Baud rate for general usage
dumpall = false     # Include all output messages
~~~

- `port`: Serial port name or path. See also [device names](@ref devicenames).
- `initialbaud`: Initial baud rate to use. Some uBlox devices start at a slower rate and need to be reconfigured to a more suitable rate for general data transfer, so set the initial power-up/reset baud rate here.
- `baud`: General baud rate to use after initial configuration.
- `dumpall`: Enable unfiltered output, passing (and recording) additional messages in the output file. Otherwise, only parsed messages are saved, reducing the size of the recorded data files.

### MP Source Options {#LoggerSource-MP}
**type = MP** or **type = SL**

This source type is for use with devices that directly output msgpack formatted data as described in the [Logger technical details](@ref LoggerTechDetails) page.

~~~{.py}
[MP02]
type = MP           # Mandatory
port = /dev/ttyACM0 # Path to serial device
baud = 115200       # Baud rate
~~~

- `port`: Serial port name or path. See also [device names](@ref devicenames).
- `baud`: General baud rate to use after initial configuration.

Note that the general `sourcenum` and `name` parameters are ignored here, as they will be provided directly by the connected device.

The source tag (`MP02` in this example) will be used in any log messages generated by the logging software.

### I2C Source Options {#LoggerSource-I2C}
**type = I2C**
~~~{.py}
[AutomationHat]
type = I2C                  # Mandatory
bus = /dev/i2c-1            # Path to I2C bus
ads1015=0x48:4:0.007:0.002  # Device specific configuration
frequency = 2               # Bus polling frequency
~~~

There are two general parameters that need to be provided in order to record data from I2C connected sensors.

- `bus`: Path to the I2C bus / device. See [device names](@ref devicenames) for some generic considerations here
- `frequency`: Number of sensor readings to request per second.

Unlike most other data sources, I2C readings must be requested by the logging software rather than being recorded on arrival.
The frequency set here is a single value per bus, so must be supported by all sensors in use.

After defining the bus name and polling frequency, each individual sensor must be configured.
In general, each sensor definition will need to provide a sensor type, I2C address and the (base) channel ID.

The sensor type is provided by the configuration option name (which may be present more than once), with the I2C address and base message ID provided in hex, separated by a colon. In the example configuration, an ADS1015 sensor is being configured at address 72 (0x48) and the first value provided by that sensor will be at channel 4. If the base message ID is missing, a default will be substituted. Mixing automatic and manual allocation of base message ID may lead to conflicts and is not recommended.

#### INA219 Voltage and current monitor (ina219) {#LoggerSource-INA219}
The INA219 chip measures the current being supplied to a circuit through a shunt resistor.
Each chip provides three measurements, using three sequential channel numbers:
* Channel `n`: Bus voltage (supply voltage to the positive side of the shunt resistor) [Volts]
* Channel `n+1`: Shunt voltage (voltage drop across the shunt resistor) [millivolts]
* Channel `n+2`: Current flowing to the load (calculated from the voltage drop across the shunt resistor) [Amps]

Multiple chips can be connected to a single I2C bus using different addresses, and the channel numbers can optionally be set in the configuration file.

To read from an INA219 chip, add the following line to the source definition:
~~~{.py}
# ina219 = address[:channel]
ina219 = 0x32    # Device at address 0x32, automatically numbering channels
ina219 = 0x33:7  # Device at address 0x33, using channels 7, 8, and 9

~~~

Add additional lines for each chip connected to that I2C bus.

As an example, the [Waveshare Current/Power monitor hat](https://www.waveshare.com/wiki/Current/Power_Monitor_HAT) could be configured as shown:

~~~{.py}
[PM]
type = I2C
bus = /dev/i2c-1
frequency = 2
ina219 = 0x40:4
ina219 = 0x41:7
ina219 = 0x42:10
ina219 = 0x43:13
~~~

#### ADS1015 ADC (ads1015) {#LoggerSource-ADS1015}
\todo ADS1015 configuration explanation

### NMEA Source Options
\todo NMEA0183 configuration
\todo N2K configuration

- Source Name (name)
- Serial port (port)
- Baud rate (baud)

### Datawell Source Options
\todo Datawell configuration

- Serial port, *or*
- Network address and port

\todo Timer configuration
\todo Network source configuration
\todo Generic serial source configuration
\todo MQTT configuration (generic / victron)

## Example Configuration

~~~{.py}
stateFile = "testData/logger.state"
saveState = True
prefix = "testData/Log-"
verbose = 3
frequency = 10

[GPS01]
baud = 19200
sourcenum = 5
type = GPS
# N.B. Can't assume this will always be the same device
# Consider using udev rules to give devices permanent names
port = "/dev/ttyUSB0"
~~~

## Device Names {#devicenames}
\todo Explain about device naming on Linux and udev

## Further reading
* Up: [Logger configuration](@ref LoggerConfig)
* Prev: [Logger core options](@ref LoggerConfigCore)
